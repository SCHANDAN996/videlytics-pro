{% extends 'dashboard/base_dashboard.html' %}

{% block page_title %}Complete Your Payment{% endblock %}

{% block dashboard_content %}
<div class="max-w-lg mx-auto bg-white p-8 rounded-lg shadow-md text-center">
    <h2 class="text-2xl font-bold mb-4">Subscribe to {{ plan_name }}</h2>
    <p class="text-gray-600 mb-8">Click the button below to complete your secure payment with Razorpay.</p>
    
    <button id="rzp-button1" class="bg-green-500 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg text-lg">Pay with Razorpay</button>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<form name='razorpayform' action="{% url 'subscription_success' %}" method="POST" class="hidden">
    {% csrf_token %}
    <input type="hidden" name="razorpay_payment_id" id="razorpay_payment_id">
    <input type="hidden" name="razorpay_subscription_id" id="razorpay_subscription_id" value="{{ subscription_id }}">
    <input type="hidden" name="razorpay_signature" id="razorpay_signature">
</form>

<script>
var options = {
    "key": "{{ razorpay_key_id }}",
    "subscription_id": "{{ subscription_id }}",
    "name": "Videlytics.pro",
    "description": "Subscription for {{ plan_name }} Plan",
    "handler": function (response){
        document.getElementById('razorpay_payment_id').value = response.razorpay_payment_id;
        document.getElementById('razorpay_signature').value = response.razorpay_signature;
        document.razorpayform.submit();
    },
    "prefill": {
        "name": "{{ user_name }}",
        "email": "{{ user_email }}",
    },
    "theme": {
        "color": "#4f46e5"
    }
};
var rzp1 = new Razorpay(options);
document.getElementById('rzp-button1').onclick = function(e){
    rzp1.open();
    e.preventDefault();
}
</script>
{% endblock %}

